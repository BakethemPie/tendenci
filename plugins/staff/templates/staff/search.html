{% extends "staff/base.html" %}
{% load pagination_tags %}
{% load staff_tags %}
{% load perm_tags %}

{% block title %}Staff{% endblock %}

{% block extra_head %}
<style type="text/css">
{% include "staff/media/css/staff.css" %}
</style>
<link rel="alternate" type="application/rss+xml" title="Latest Staff" href="{% url staff.feed %}" />
{% endblock %}

{% block body %}
{% autopaginate staff 5 %}
{% has_perm user staff.add_staff as can_add_staff %}
<div class="t">
    <h1>Staff Search</h1>
    {% staff_search %}
    {% if can_add_staff %}
    <div><a href="{% url admin:staff_staff_add %}">Add Staff</a></div>
    {% endif %}
    <div class="staff-search-wrap">
        {% for staff_member in staff %}
        {% with staff_member.object as staff_member %}
        <div class="staff-search-member">
            <div class="quick-options">
                {% staff_options request.user staff_member %}
            </div>
            <table border="0" width="100%" cellspacing="0" cellpadding="0">
                <tr>
                    <td class="member-photo">
                        <a href="{{ staff_member.get_absolute_url }}">
                        <img src="{% url staff.photo staff_member.pk "128x128" %}" title="{{ staff_member.name }}"  />
                        </a>
                        <p><a href="{{ staff_member.get_absolute_url }}">{{ staff_member.name }}</a></p>
                    </td>
                    <td class="member-info">
                        <p>
                            {% spaceless %}
                            <a href="{{ staff_member.get_absolute_url }}">{{ staff_member.name }}</a>
                            {% if staff_member.department %}
                            &nbsp;&ndash;&nbsp;
                                <a href="{% url staff.search %}?q=department:{{ staff_member.department }}">
                                    {{  staff_member.department }}
                                </a>
                            {%  endif %}
                            {% if staff_member.position %}
                            &nbsp;&ndash;&nbsp;
                                <a href="{% url staff.search %}?q=position:{{ staff_member.position }}">
                                    {{  staff_member.position }}
                                </a>
                            {%  endif %}
                            {% endspaceless %}
                        </p>
                        {% if staff_member.biography %}
                        <p>{{ staff_member.biography|striptags|truncatewords:"80" }}</p>
                        {% endif %}
                        <p>
                           {% if staff_member.years == 0 %}
                               <strong>New Employee!</strong>
                           {% else %}
                               Employee for <strong>{{ staff_member.years }}</strong> year{{ staff_member.years|pluralize:"s" }}
                           {% endif %}
                        </p>
                    </td>
                </tr>
            </table>
        </div>
        {% endwith %}
        {% empty %}
            <p>0 Staff Found</p>
        {% endfor %}
    </div>
    {% paginate %}
</div>
{% endblock body %}

{% block extra_body %}
    <script type="text/javascript" src="{{ STATIC_URL }}js/global/dropdown.js"></script>
	<script type="text/javascript">
		var iconrow = new dropdown({
			container:	'more-options-wrap',
			trigger:	'more-options-trigger',
			target:		'more-options-target'
		});
	</script>
{% endblock %}
