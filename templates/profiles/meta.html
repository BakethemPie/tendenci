{% load base_filters %}
{% load base_tags %}
{% load avatar_tags %}
{% load profile_tags %}
{% load perm_tags %}
{% load i18n %}

{% get_or_create_profile_for user_this as "user_this_profile" %}
{% assign can_edit_user user_this_profile|args:request.user|call:'allow_edit_by' %}
{% is_admin user_this as admin %}
{% is_admin request.user as viewer_admin %}

<div class="meta {% if not user.is_authenticated %}anon{% endif %}">
    <div class="meta-left">
        {% if user.is_authenticated %}
            <div class="submitted">{% blocktrans with profile.create_dt|date:"long" as create_date %}Created on {{ create_date }}
                by:{% endblocktrans %} <a href="{{ profile.creator.get_absolute_url }}">
                {% if profile.creator.first_name %}{{ profile.creator.first_name }} {{ profile.creator.last_name }}
                {% else %}
                {{ profile.creator }}
                {% endif %}</a>
            </div>
            <div class="submitted">{% blocktrans with profile.update_dt|date:"long" as update_date %}Last updated {{ update_date }}
                by:{% endblocktrans %} <a href="{{ profile.owner.get_absolute_url }}">
                {% if profile.owner.first_name %}{{ profile.owner.first_name }} {{ profile.owner.last_name }}
                {% else %}
                {{ profile.owner }}
                {% endif %}</a>
            </div>
        {% endif %}
        
    </div>
    <div class="meta-right">
        <a class="share-link" >{% trans "Share" %}</a>
    </div>
</div>
{% if can_edit_user %}
<div class="editor-bar">

    <div class="perm-status">
    <ul>
        <li>{{ profile.obj_perms }}</li>
        <li>{{ profile.obj_status }}</li>
    </ul>
    </div>
    <div class="edit-links">
    <ul>
        <li><a class="eventlog-link" href="{% url event_log.search %}?object_id={{ profile.pk }}&source={{ profile.opt_app_label }}">{% trans "Eventlogs" %}</a></li>
        <li><a class="edit-link" href="{% url profile.edit user_this.id %}">{% trans "Edit" %}</a></li>
        <li><a class="options-link" href="#">{% trans "Options" %} <small>&#9650;</small></a>
        <div class="options-list">
            <ul>
                <li>
                    <a href="{% url profile.edit_groups user_this.username %}" class="usergroups" title=="Edit Groups">{% trans "Edit Groups" %}</a>
                </li>
                <li>
                    <a href="{% url auth_password_change user_this.id %}" class="changepassword" title="Change Password">{% trans "Change Password" %}</a>
                </li> 
                {% if viewer_admin %}
                    <li>
                        <a href="{% url profile.edit_perms user_this.id %}" class="permissions" title="Edit Permissions">{% trans "Permissions" %}</a>
                    </li>
                    <li>
                        <a href="{{ request.path }}?_impersonate={{ user_this.username }}" class="permissions" title="Impersonate">{% trans "Impersonate" %}</a>
                    </li>
                    <li>
                        <a href="{% url profile.delete user_this.id %}" class="delete" title="Delete User">{% trans "Delete" %}</a>
                    </li>
                {% endif %}
            </ul>
        </div>
        </li>
    </ul>
    </div>
</div> 
{% endif %}
