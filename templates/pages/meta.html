{% load base_filters %}
{% load base_tags %}
{% load page_tags %}
{% load perm_tags %}
{% load tagging_tags %}
{% load category_tags %}
{% load i18n %}

{% has_perm user pages.change_page search_object as can_edit %}
{% has_perm user pages.delete_page search_object as can_delete %}
{% get_category_for_object search_object as category %}
{% get_sub_category_for_object search_object as sub_category %}
{% tags_hash_tags search_object as hash_tags %}
{% tags_strip_hash search_object as nonhash_tags %}


            <div class="meta {% if not user.is_authenticated and not category and not nonhash_tags %}anon{% endif %}">
                <div class="meta-left">
                    {% if category %}
                    <div class="categories">
                        <strong>{% trans "Category:" %} </strong><a href="{% url page.search %}?q=category:{{ category }}">{{ category }}</a>
                    {% if sub_category %}
                        | <strong>{% trans "Sub Category:" %} </strong><a href="{% url page.search %}?q=sub_category:{{ sub_category }}">{{ sub_category }}</a>
                    {% endif %} 
                    </div>
                    {% endif %}
    
                    {% if nonhash_tags or hash_tags %}
                    <div class="tags">
                        {% if nonhash_tags or can_edit %}<strong>Tags: </strong>{% endif %}
                        {% for tag in nonhash_tags %}
                            <a href="{% url page.search %}?q=tag:{{ tag }}">{{ tag }}</a>{% if not forloop.last %}, {% endif %}
                        {% endfor %}
                        
                        {% if hash_tags and can_edit %}
                        {% for tag in hash_tags %}
                            {% if forloop.first and nonhash_tags %}| {% endif %}<a href="{% url page.search %}?q=tag:{{ tag }}">{{ tag }}</a>{% if not forloop.last %}, {% endif %}
                        {% endfor %}
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    {% if user.is_authenticated %}
                    <div class="submitted">{% blocktrans with search_object.create_dt|date:"long" as create_date %}Created on {{ create_date }}
                    by:{% endblocktrans %} <a href="{{ search_object.creator.get_absolute_url }}">
                    {% if search_object.creator.first_name %}{{ search_object.creator.first_name }} {{ search_object.creator.last_name }}
                    {% else %}
                    {{ search_object.creator }}
                   {% endif %}</a>
                    </div>
                    {% endif %}
                    {% if user.is_authenticated %}
                    <div class="submitted">{% blocktrans with search_object.update_dt|date:"long" as update_date %}Last updated {{ update_date }}
                    by:{% endblocktrans %} <a href="{{ search_object.owner.get_absolute_url }}">
                    {% if search_object.owner.first_name %}{{ search_object.owner.first_name }} {{ search_object.owner.last_name }}
                    {% else %}
                    {{ search_object.owner }}
                   {% endif %}</a>
                    </div>
                    {% endif %}
                    
                </div>
                <div class="meta-right">
                    <a class="print-link" href="{% url page.print_view search_object.slug %}">{% trans "Print" %}</a>
                    <a class="share-link" >{% trans "Share" %}</a>
                </div>
            </div>
            {% if can_edit %}
            <div class="editor-bar">

                <div class="perm-status">
                <ul>
                    <li>{{ search_object.obj_perms }}</li>
                    <li>{{ search_object.obj_status }}</li>
                </ul>
                </div>
                <div class="edit-links">
                <ul>
                    <li><a class="eventlog-link" href="{% url event_log.search %}?object_id={{ search_object.pk }}&source={{ search_object.opt_app_label }}">{% trans "Eventlogs" %}</a></li>
                    <li><a class="edit-link" href="{% url page.edit search_object.pk %}">{% trans "Edit" %}</a></li>
                    <li><a class="options-link" href="#">{% trans "Options" %} <small>&#9650;</small></a>
                    <div class="options-list">
                        <ul>
                        {% if can_delete %}
                        <li>
                            <a class="delete" href="{% url page.delete search_object.pk %}">{% trans "Delete" %}</a>
                        </li>               
                        {% endif %}
                            <li><a href="{% url page.edit.meta search_object.pk %}">{% trans "Edit Meta" %}</a></li>
                            <li><a href="{% url category.update search_object.opt_app_label search_object.opt_module_name search_object.pk %}">{% trans "Edit Categories" %}</a></li>
                            
                        </ul>
                    </div>
                    </li>
                </ul>
                </div>
            </div> 
            {% endif %}
