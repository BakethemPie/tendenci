{% extends "events/base.html" %}
{% load event_tags %}
{% load styled_forms %}
{% load avatar_tags %}
{% load base_filters %}

{% block title %}{{ block.super }}Register{% endblock %}

{% block extra_head %}
{{ block.super }}
<link rel="stylesheet" href="{{ STATIC_URL }}css/events.css">
{% endblock %}

{% block body %}
<style type="text/css">
	.regconf-section {
		background-color: #F7F7F7;
		border: 1px solid silver;
		margin-bottom: 10px;
	}
	.regconf-section h2 {
		background-color: #DDD;
		padding: 10px;
	}
	.regconf-section h3 {
		margin: 10px 10px 0;
	}
	.regconf-section .event-url {
		margin-top: 0;
	}
	.regconf-section div {
		margin: 10px;
	}	
	
	.registration .avatar {
		float: left;
	}
	.registration .info {
		margin-top: 20px;
	}
	.registration .info .name,
	.registration .info .email {
		margin: 0;
	}
	
	.cancel-notice {
		background-color: #FFC;
		border: 1px solid #fcd574;
		padding: 10px 5px;
		margin-bottom: 10px;
	}
	.cancel-notice2 {
		background-color: #FFC;
		margin-bottom: 10px;
		padding: 2px;
	}
	.canceled-amount{
		text-decoration: line-through;
	}

</style>

<div class="t">    
    {% event_nav user event %}
    <h1>Registration</h1>

    <div class="registration-status">

        {% if registration.canceled %}
            <div class="not-registered">Registration cancelled.</div>
        {% endif %}

        {% if registration.status == 'payment-required' %}
            <div class="almost-registered">Almost registered. Payment is still required.

            {% if event.registration_configuration.can_pay_online %}
            <a href="{% url payment.pay_online registration.invoice.pk registration.invoice.guid %}">
                Complete registration.</a>
            {% endif %}
            </div>

        {% endif %}

        {% if registration.status == 'registered-with-balance' %}
            <div class="registered">You are registered. Balance is ${{ registration.invoice.balance }}.

            {% if event.registration_configuration.can_pay_online and registration.invoice.balance > 0 %}
            <a href="{% url payment.pay_online registration.invoice.pk registration.invoice.guid %}">
                Pay online.</a>
            {% endif %}
            </div>

        {% endif %}

        {% if registration.status == 'registered' %}
            <div class="registered">You are registered. Enjoy the event!</div>
        {% endif %}

    </div>


	{% if count_registrants == 1 and registration.canceled %}
		<div class="cancel-notice">
			Registration Canceled on {{ registrant.cancel_dt|date_short }}
		</div>
	{% endif %}

	<div class="regconf-section event">
		<h2>Event Details</h2>
		<h3>{{ event.title }}</h3>

		<div class="event-url">
			<a href="{% url event event.pk %}">
				{{ SITE_GLOBAL_SITEURL }}{% url event event.pk %}
			</a>
		</div>

		
		<div>{{ event.description|safe }}</div>
	</div>

	<div class="regconf-section registration">
		<h2>Your Details</h2>
		<h3>
            Registration Number: {{ registration.pk }}
        </h3>
        
        
		{% if not registration.canceled %}
			<div>
			 <a href="{% if hash %}{% url event.registration_edit registration.pk, hash %}{% else %}{% url event.registration_edit registration.pk %}{% endif %}">Edit Registrant(s) Info</a>
			 
			{% if count_registrants == 1 %}
					&nbsp;&nbsp;
			      {% if user.is_authenticated %}
			          <a href="{% url event.cancel_registration event.pk registrant.pk %}">Cancel Registation</a>
			      {% else %}
			          <a href="{% url event.cancel_registration event.pk registrant.hash %}">Cancel Registation</a>
			      {% endif %}
		     {% endif %}
		      </div>
	     {% endif %}
	     
	    {% if count_registrants > 1 %}
	    	<div style="font-weight: bold;">Registrants ... ({{ count_registrants }})</div>
	    {% endif %}
	            
        {% for registrant in registrants %}
			<div class='avatar'>{% avatar registrant.user 56 %}</div>
			<div class="info">
	            
				<div class="name">
				{% if registrant.first_name or registrant.last_name %}
	                {% if registrant.first_name %}
	                    {{ registrant.first_name }}
	                {% endif %}
	                {%  if registrant.last_name %}
	                    {{ registrant.last_name }}
	                {% endif %}
	            {% else %}
	            	Guest #{{ forloop.counter0 }}
	            {% endif %}
	            </div>
	            
				<div class="email">{% firstof registrant.email "Email Not Recorded" %}</div>
				<div class="amount">Amount: 
				<span{% if registrant.cancel_dt %} class="canceled-amount"{% endif %}>
						{{ registrant.amount|format_currency }}
				</span>
				
				
				
				{% if registrant.cancel_dt %}
					<span class="cancel-notice2">
						Canceled on {{ registrant.cancel_dt|date_short }}
					</span>
				{% else %}
					{% if user.is_authenticated %}
				          <a href="{% url event.cancel_registration event.pk registrant.pk %}">Cancel</a>
				      {% else %}
				          <a href="{% url event.cancel_registration event.pk registrant.hash %}">Cancel</a>
				      {% endif %}
				{% endif %}
				
				
				</div>
				
			</div>
			<div style="clear:both;"></div>
		 {% endfor %}
		
	</div>
	

	<div class="regconf-section payment">
		<h2>Payment Details</h2>

        <div class="payment-links">
            <a href="{% url invoice.view registration.invoice.pk registration.invoice.guid %}">View invoice</a>

            {% if event.registration_configuration.can_pay_online and registration.invoice.balance > 0 %}
                <a href="{% url payment.pay_online registration.invoice.pk registration.invoice.guid %}">Pay online</a>
            {% endif %}
        </div>

        <div class="payment-accounting">
            <div>Total ${{ registration.invoice.total|floatformat:"2" }}</div>
            <div><strong>Balance ${{ registration.invoice.balance|floatformat:"2" }}</strong></div>
        </div>

		<div style="clear:both;"></div>
	</div>

</div>
{% endblock %}