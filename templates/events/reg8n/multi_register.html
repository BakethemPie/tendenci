{% extends "events/base.html" %}
{% load event_tags %}
{% load styled_forms %}
{% load base_filters %}

{% block title %}{{ block.super }}Register{% endblock %}

{% block extra_head %}
{{ block.super }}
<link rel="stylesheet" href="{{ STATIC_URL }}css/events.css">
{% endblock %}

{% block body %}

<style type="text/css">

	.t h1 {
		margin-bottom: 0;
	}
	.t div.event-title {
		font-size: 1.2em;
		margin-bottom: 10px;
	}

	.price {
		font-size: 1.6em;
		margin-bottom: 10px;
		background-color: #FFC;
		padding: 10px;
	}
	
	.registrant-header{
		border-bottom: 1px dotted #ccc;
		margin: 2em 0 1em;
		padding: 5px 8px;
		font-weight: bold;
	}
	.even-registrant, .odd-registrant{
		background-color: #f5f5f5;
		padding: 10px;
	}
	.event-price-display{
		background-color: #ffffcc;
		font-size: 1.6em;
		margin-bottom: 10px;
		padding: 10px;
		width: 10em;
	}
	#reg-form-box{
		position: absolute;
		top: 0;
		right: 0;
		border: 1px solid #ccc;
		background-color: #fff;
		padding: 1em;
		-moz-border-radius: 8px;
		border-radius: 8px;
	}
	#registrant-forms{
		width: 90%;
	}
	#reg-summary{
		font-weight: bold;
		font-size: 1.2em;
		margin-bottom: 1em;
		border-bottom: 1px solid silver;
	}
	#total-label,#total-value{ 
		border-top: 1px solid #ccc;
		font-weight: bold;
	}
	#summary-price{
		width: 90%;
		margin-bottom: 1em;
	}
	#summary-price td{
		padding: 3px;
	}
	#register-button{
		background-color: lightblue;
		font-weight: bold;
		font-size: 1.2em;
	}

</style>

<div class="t">    
    {% event_nav user %}
    <h1>Register for Event - <a href="{% url event event.id %}">{{ event.title }}</a></h1>
		<div class="event-price-display">
		Price:
		{{ event.registration_configuration.price|format_currency }}</div>
	{{ form.non_field_errors }}
	{% for field in form %}
		{% if field.errors %}
			<li><a href="javascript:;">{{ field.label_tag }}</a></li>	
		{% endif %}
	{% endfor %}

	<div class="form-wrap" style="position:relative;">
    	<form action="" method="post">
    	<div class="forms">
    		<div id="reg-form-box">
    			<div id="reg-summary">Summary</div>
    			
    			{% if not free_event %}
    				{# price list #}
    				<table id="summary-price">
    					{% for price in price_list %}
    					<tr>
	    					<td width="50%">Reg #{{ forloop.counter }}</td>
	    					<td width="50%" align="right">{{ price|format_currency}}</td>
    					</tr>
    					{% endfor %}
    					<tr>
    						<td><div id="total-label">Total</div></td>
    						<td align="right"><div id="total-value">{{ total_price|format_currency }}</div></td>
    					</tr>
    				</table>
    			
    			{% endif %}
    			
   				{% if reg_form.payment_method %}
					<div class="form-field">
						<div class="error">{{ reg_form.payment_method.errors }}</div>
						<div class="required">Payment Method</div>
						<div class="field">{{ reg_form.payment_method }}</div>
					</div>
				{% endif %}
				
				{% if reg_form.captcha %}
					<div class="form-field">
						<div class="error">{{ reg_form.captcha.errors }}</div>
						<div class="required">Type the Code Below</div>
						<div class="field">{{ reg_form.captcha }}</div>
					</div>
				{% endif %}
   				<input type="submit" id="register-button" value="{% if free_event %}Register for this Event{%else%}Register & Pay{%endif%}" />
    		</div>
    		
    		<div id="registrant-forms">
	    		{{ registrant.management_form }}
				{% for form in registrant.forms %}
					
					<div id="registrant_{{ forloop.counter }}">
						{% if total_regt_forms > 1 %}
							<div class="registrant-header">
								Registrant #{{ forloop.counter }}:
							</div>
						{% endif %}
					
						<div class="{% cycle 'odd-registrant' 'even-registrant'%}">
						
							{% if form.first_name %}
							<div class="form-field">
								<div class="error">{{ form.first_name.errors }}</div>
								<div class="label required">First Name</div>
								<div class="field">{{ form.first_name }}</div>
							</div>
							{% endif %}
				
							{% if form.last_name %}
							<div class="form-field">
								<div class="error">{{ form.last_name.errors }}</div>
								<div class="label required">Last Name</div>
								<div class="field">{{ form.last_name }}</div>
							</div>
							{% endif %}
				
				        	{% if form.company_name %}
							<div class="form-field">
								<div class="error">{{ form.company_name.errors }}</div>
								<div class="label">Company</div>
								<div class="field">{{ form.company_name }}</div>
							</div>
							{% endif %}
				
							{% if form.phone %}
							<div class="form-field">
								<div class="error">{{ form.phone.errors }}</div>
								<div class="label">Phone</div>
								<div class="field">{{ form.phone }}</div>
							</div>
							{% endif %}
				
							{% if form.email %}
							<div class="form-field">
								<div class="error">{{ form.email.errors }}</div>
								<div class="label required">Email</div>
								<div class="field">{{ form.email }}</div>
							</div>
							{% endif %}	
							
							{% if forloop.counter > 1 %}
								{% if form.DELETE %}
								<div class="form-field delete">
									<div>{{ form.DELETE }} Delete</div>
								</div>
								{% endif %}	
							{% endif %}	
						</div>	
					</div>
					
				{% endfor %}
			</div>
			<div class="clear"></div>
		
			 <input title='Add a registrant' type='submit' name='add_registrant' value='Add another registrant' />

		</div>
        </form>
	</div>

</div>
{% endblock %}

{% block extra_body %}
 <script type="text/javascript">
	$(document).ready(function(){

		// delete confirmation
		$('.delete').click(function(){
			var delete_confirm = confirm('Are you sure you want to delete this registrant?');	// confirm
			if(delete_confirm) {
				var registrant_to_delete = $(this).closest("div[id^='registrant_']");
				var attr_id = $(registrant_to_delete).attr("id");
				//alert(attr_id);
				//alert($(registrant_to_delete).html());
				$(registrant_to_delete).remove();
			}
			return false;	// cancel
		});
	});
   </script>
{% endblock %}