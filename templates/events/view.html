{% extends "events/base-wide.html" %}
{% load perm_tags %}
{% load event_tags %}
{% load tagging_tags %}
{% load base_tags %}
{% load category_tags %}
{% load humanize %}


{% block title %}{{ block.super }}{{ event.get_title }}{% endblock %}
{% block meta_description %}{{ event.get_description }}{% endblock %}
{% block meta_keywords %}{{ event.get_keywords }}{% endblock %}
{% block meta_canonical_url %}<link rel="canonical" href="{{ event.get_canonical_url }}" />{% endblock %}

{% block extra_head %}
{{ block.super }}
<link rel="stylesheet" href="{{ STATIC_URL }}css/events.css">
<link rel="stylesheet" href="{{ STATIC_URL }}css/tipsy.css">
{% endblock %}

{% block body %}

{% has_perm user events.change_event as can_edit %}

<div class="t">
    {% event_nav user event %}
    <div class="event-wrap">
		<div class="info">
	        <h1>{{ event.title }}</h1>

            {% for speaker in speakers %}
                {% if speaker.name %}
                <div class="speaker-wrap">
                    {% if speaker.get_photo %}
                    <div class="speaker-photo">
                      <img alt="Speaker: {{ speaker.name }}" src="{% url file speaker.get_photo.pk %}"  width="100" />
                    </div>
                    {% endif %}
                    <div class="speaker">
                        <strong>Speaker</strong> {{ speaker.name }}
                    </div>
                    {% if speaker.description|striptags|wordcount > 50 %}
                    <div class="speaker-desc-short">
                        {{ speaker.description|striptags|truncatewords:"50" }}
                    </div>
                    <div class="speaker-desc-long">
                        {{ speaker.description|safe|urlize|linebreaks }}
                    </div>
                    {% else %}
                        <div class="speaker-desc-short">
                            {{ speaker.description|safe|urlize|linebreaks }}
                        </div>                    
                    {% endif %}
                    {% if speaker.description|striptags|wordcount > 50 %}
                    <a class="speaker-desc-toggle" href="#">Full Description</a>
                    {% endif %}
                    <div style="clear:both;"></div>
                </div>
                {% endif %}                        
            {% endfor %}
	        
            <!-- event description -->
            <div class="content">
                <div class="event-desc">{{ event.description|safe }}</div>
            </div>

            {% if organizer.name %}
            <div class="organizer-wrap">
                <div class="organizer">
                    <strong>Organizer</strong> {{ organizer.name }}
                </div>
                {% if organizer.description|striptags|wordcount > 50 %}
                <div class="organizer-desc-short">
                    {{ organizer.description|striptags|truncatewords:"50" }}
                </div>
                <div class="organizer-desc-long">
                    {{ organizer.description|safe|urlize|linebreaks }}
                </div>
                {% else %}
                    <div class="organizer-desc-short">
                        {{ organizer.description|safe|urlize|linebreaks }}
                    </div>                    
                {% endif %}
                {% if organizer.description|striptags|wordcount > 50 %}
                <a class="organizer-desc-toggle" href="#">Full Description</a>
                {% endif %}
            </div>
            {% endif %}
		</div> <!-- end info -->

		<div class="vitals">
            <div class="time-period">
                <h4 class="vital-header">When?</h4>
                {% ifequal event.start_dt|date:"M j, Y" event.end_dt|date:"M j, Y" %}
                <div class="line">{{ event.start_dt|date:"M j, Y" }}</div> 
                {% else %}
                <div class="line">{{ event.start_dt|date:"M j" }} - {{ event.end_dt|date:"M j, Y" }}</div>
                {% endifequal %} 
                <div class="line">{{ event.start_dt|date:"P" }} - {{ event.end_dt|date:"P" }} {{ event.timezone }}</div>
            </div>

            {% if event.registration_configuration.enabled %}
            <div class="pricing">
                <h4 class="vital-header">How Much?</h4>
                {% registration_pricing_and_button event request.user %}
            </div>
            {% endif %}

			<div class="place">
                <h4 class="vital-header">Where?</h4>
				<div><strong>{{ event.place.name }}</strong></div>
				<div class="line">{{ event.place.address }}</div>
				<div class="line">{{ event.place.city_state|join:", "}} {{ event.place.zip }}</div>
                <div class="line">{{ event.place.country }}</div>
                {% if event.place.description|striptags|wordcount > 50 %}
                    <div class="line event-place-desc-short">
                        {{ event.place.description|striptags|truncatewords:"50" }}
                    </div>
                    <div class="line event-place-desc-long">
                        {{ event.place.description|safe|urlize|linebreaks }}
                    </div>
                {% else %}
                        <div class="line event-place-desc-short">
                            {{ event.place.description|safe|urlize|linebreaks }}
                        </div>        
                {% endif %}
                {% if event.place.description|striptags|wordcount > 50 %}
                    <a class="line event-place-desc-toggle" href="#">Full Description</a> 
                {% endif %}
			</div>

			<div class="hr"></div>

            {% if event.place.address and event.place.city_state %}
            <div class="map">
<iframe width="250" height="350" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="http://maps.google.com/maps?q={{ event.place.address }}+{{ event.place.city_state|join:", "}}+{{ event.place.zip }}&amp;ie=UTF8&amp;hl=en&amp;view=map&amp;hq=&amp;hnear={{ event.place.address }}+{{ event.place.city_state|join:", "}}+{{ event.place.zip }}&amp;z=12&amp;output=embed"></iframe><br /><small><a href="http://maps.google.com/maps?q={{ event.place.address }}+{{ event.place.city_state|join:", "}}+{{ event.place.zip }}&amp;ie=UTF8&amp;hl=en&amp;view=map&amp;hq=&amp;hnear={{ event.place.address }}+{{ event.place.city_state|join:", "}}+{{ event.place.zip }}&amp;z=14&amp;ll=29.784544,-95.593006&amp;source=embed" style="color:#0000FF;text-align:left">View Larger Map</a></small>
            </div>
            {% endif %}
            {% url event event.pk as the_url %}
            <p>{% fb_like_button_iframe the_url %}</p>
		</div> <!-- end vitals -->

		<div style="clear:both;"></div>
    </div>

    <!-- delete-article form -->
    <form name="delete-item" method="POST" action="{% url event.delete event.pk %}">{% csrf_token %}
        <input type="hidden" name="action" value="delete">
    </form>

</div>

{% endblock %}

{% block extra_body %}
    {{ block.super }}
    <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.tipsy.js"></script>
    <script type="text/javascript">
		$(document).ready(function(){

            // delete confirmation
            $('a.delete').click(function(){
                var delete_item = confirm('Permenantly delete {% firstof MODULE_EVENTS_LABEL 'Event' %}?');  // confirm
                if(delete_item) $('.t').find('form[name="delete-item"]').submit() // delete: if OK
                return false;   // cancel
            });

            $('td.price-disabled').tipsy({
                gravity: 'e', 
                live: true 
            });
            // speaker description toggle
            $('a.speaker-desc-toggle').click(function() {
                var _this = $(this);
                var speaker_wrap = _this.parents('.speaker-wrap');

                _this.hide();
                speaker_wrap.find('div.speaker-desc-short').hide();
                speaker_wrap.find('div.speaker-desc-long').show();
                return false;
            });

            // organizer description toggle
            $('a.organizer-desc-toggle').click(function() {
                var _this = $(this);
                var speaker_wrap = _this.parents('.organizer-wrap');

                _this.hide();
                speaker_wrap.find('div.organizer-desc-short').hide();
                speaker_wrap.find('div.organizer-desc-long').show();
                return false;
            });

            // event description toggle
            $('a.event-place-desc-toggle').click(function() {
                var _this = $(this);
                var speaker_wrap = _this.parents('.place');

                _this.hide();
                speaker_wrap.find('div.event-place-desc-short').hide();
                speaker_wrap.find('div.event-place-desc-long').show();
                return false;
            });

			// Dialog			
			$('#event_export_dialog').dialog({
				autoOpen: false,
				width: 600,
				buttons: { 
					"Close": function() { 
						$(this).dialog("close"); 
					} 
				}
			});
			// Dialog Link
			$('#event_export_link').click(function(){
				$('#event_export_dialog').show();
		        $('#event_export_dialog').dialog('open'); 
		 
				return false;
			});
		});
    </script>
{% endblock %}
