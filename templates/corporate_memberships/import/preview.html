{% extends "corporate_memberships/base-wide.html" %}
{% load corporate_memberships_tags %}
{% load base_tags %}
{% load base_filters %}

{% block title %}Import Corporate Memberships from CSV file{% endblock %}

{% block extra_head %}
{{ block.super }}
    <link rel="stylesheet" href="{{ STATIC_URL }}css/corporate_memberships.css">

	<style type="text/css">

		table {
			margin-top: 5px;
			white-space: nowrap;
			border: 1px solid silver;
		}

		tr.header {
			background-color: #DDD;
			text-align: left;
		}

		tr.even {
			background-color: #EEE;
			border: 1px solid silver;
			border-top: 0;
			border-bottom: 0;
		}

		tr td {
			padding: 10px;
		}
		.action-insert{
			color: #005FCF;
		}
		.action-update{
			color: green;
		}
		.action-skip{
			color: purple;
		}
		.invalid-msg{
			background-color: yellow;
		}
		.action-invalid{
			color: red;
			background-color: yellow
		}
	</style>

{% endblock %}

{% block body %}
 {% corpmemb_nav request.user %}
<div id="corp-import-wrap" class="preview">

	<h1>Corporate Membership Import</h1>
	<div id="corp-import">
		<p class="import-timestamp">{{ datetime.now }}</p>
	    <h3 class="corp-import-step">Step 3/4 - Preview</h3>
		 <div class="clear-right"></div>  

	<p class="msg">Total: <em>{{ corp_membs|length}}</em>;
	{% if invalid_skipped %}
	<em class="action-invalid">{{ invalid_skipped|length }}</em> {{ invalid_skipped|length|pluralize:"is,are" }} invalid and will be skipped,
	{% endif %}
	<em>{{ added|length }}</em> will be added, 
	and {% if skipped %}
		<em>{{ skipped|length }}</em> will be skipped (existing record)
	{% else %}
		{% if updated %}
			<em>{{ updated|length }}</em> will be updated (for the blank fields)
		{% else %}
			<em>{{ updated_override|length }}</em> will be updated (override)
		{% endif %}
	{% endif %}.
	<em><a title="Looks good!" href="{% url corp_memb_import_confirm %}">Import Now &rarr;</a></em></p>

	<table>
		<tr class="header">
			<td></td>
			<td>Name</td>
			<td>Type</td>
			<td>Join Date</td>
			<td>Expiration Date</td>
			<td>Action to Take</td>
		</tr>

	{% for corp_memb in corp_membs|slice:":25" %}
		<tr class="{% cycle 'odd' 'even' as rowcolors %}">
			<td>{{ forloop.counter }}</td>
			<td><div>{{ corp_memb.name }}</div></td>
			<td><div>{{ corp_memb.corporate_membership_type.name }}</div></td>
			{% if not corp_memb.is_valid %}
				<td colspan="2"><div class="invalid-msg">{{ corp_memb.err_msg }}</div></td>
				<td><div class="action-invalid">Not valid - will be skipped</div></td>
			{% else %}
				<td><div>{{ corp_memb.join_dt|date:"M d, Y" }}</div></td>
				<td><div>{{ corp_memb.expiration_dt|date:"M d, Y" }}</div></td>
				<td><div class="{% if corp_memb.pk %}{%if update_option == 'skip' %}action-skip{% else %}action-update{% endif %}{% else %}action-insert{% endif %}">
				{% if corp_memb.pk %}{%if update_option == 'skip' %}Skip{% else %}Update{% endif %}{% else %}Insert{% endif %}</div></td>
			{% endif %}
		</tr>
	{% endfor %}
	</table>
	</div>
</div>
{% endblock %}