{% load news_tags %}
{% load tagging_tags %}
{% load base_tags %}
{% load base_filters %}
{% load category_tags %}
{% load perm_tags %}
{% load i18n %}

{% has_perm user news.change_news news as can_edit %}
{% has_perm user news.delete_news news as can_delete %}
{% get_category_for_object news as category %}
{% get_sub_category_for_object news as sub_category %}
{% tags_for_object news as tags %}

<div class="meta">
    <div class="meta-left">
        <div class="submitted"><strong>{% trans "Released:" %}</strong> {{ news.release_dt|date:"long" }}
            {% if news.creator.first_name %}
                {% trans "by" %}{% if user.is_authenticated %}
                    <a href="{{ article.creator.get_absolute_url }}">{{ news.creator.first_name }} {{ news.creator.last_name }}</a>
                {% else %}
                    {{ news.creator.first_name }} {{ news.creator.last_name }}
                {% endif %}
            {% endif %}
        </div>
        
        {% if news.source %}
            <div class="submitted"><strong>{% trans "Source:" %}</strong> {{ news.source|urlize }}</div>
        {% endif %}
        
        {% if news.first_name or news.last_name or news.phone or news.fax or news.email or news.website %} 
        <div class="contact">
            {% if news.first_name or news.last_name %}
                <div>{{ news.first_name }} {{ news.last_name }}</div>
            {% endif %}	
            {% if news.phone %}
                <div>{{ news.phone }}</div>	
            {% endif %}	
            {% if news.fax %}
                <div>{{ news.fax }}</div>	
            {% endif %}	
            {% if news.email %}
            <div>{{ news.email|obfuscate_email }}</div>
            {% endif %}
            {% if news.website %}	
            <div>{{ news.website|urlize }}</div>	
            {% endif %}
        </div> 
        {% endif %}
        
        {% if category %}
        <div class="categories">
            <strong>{% trans "Category:" %} </strong><a href="{% url news.search %}?q=category:{{ category }}">{{ category }}</a>
        {% if sub_category %}
            | <strong>{% trans "Sub Category:" %} </strong><a href="{% url news.search %}?q=sub_category:{{ sub_category }}">{{ sub_category }}</a>
        {% endif %}	
        </div>
        {% endif %}

        {% if tags %}
        <div class="tags"><strong>{% trans "Tags:" %} </strong>
            {% for tag in tags %}
                <a href="{% url news.search %}?q=tag:{{ tag }}">{{ tag }}</a>{% if not forloop.last %}, {% endif %}
            {% endfor %}
        </div>
        {% endif %}
        
        {% if can_edit %}
        <div class="submitted">{% blocktrans with news.update_dt|date:"long" as update_date %}Last updated {{ update_date }}
        by:{% endblocktrans %} <a href="{{ news.owner.get_absolute_url }}">
        {% if news.owner.first_name %}{{ news.owner.first_name }} {{ news.owner.last_name }}
        {% else %}
            {{ news.owner }}
        {% endif %}</a>
        </div>
        {% endif %}
    </div>
    <div class="meta-right">
        <a class="print-link" href="{# url news.print_view news.slug #}">Print</a>
        <a class="share-link" >{% trans "Share" %}</a>
    </div>
</div>
{% if can_edit %}
<div class="editor-bar">

    <div class="perm-status">
    <ul>
        <li>{% obj_perms news %}</li>
        <li>{% obj_status news %}</li>
    </ul>
    </div>
    <div class="edit-links">
    <ul>
        <li><a class="eventlog-link" href="{% url event_log.search %}?object_id={{ news.pk }}&source={{ news.opt_app_label }}">{% trans "Eventlogs" %}</a></li>
        <li><a class="edit-link" href="{% url news.edit news.pk %}">{% trans "Edit" %}</a></li>
        <li><a class="options-link" href="#">{% trans "Options" %} <small>&#9650;</small></a>
        <div class="options-list">
            <ul>
            {% if can_delete %}
            <li>
                <a class="delete" href="{% url news.delete news.pk %}">{% trans "Delete" %}</a>
            </li>				
            {% endif %}
                <li><a href="{% url news.edit.meta news.pk %}">{% trans "Edit Meta" %}</a></li>
                <li><a href="{% url category.update news.opt_app_label news.opt_module_name news.pk %}">{% trans "Edit Categories" %}</a></li>
                
            </ul>
        </div>
        </li>
    </ul>
    </div>
</div> 
{% endif %}
